# 基于消费收益角度的用户价值分析及运营策略



# 一.项目背景

### 1. 概述

项目背景：本项目使用某公司用户消费相关数据，根据用户的个人ID、订单号、交易日期、会员等级等数据，基于消费

收益角度通过分组对不同用户群体的价值度进行了分析。

分析流程：首先进行数据探索和数据预处理，基于业务理解清洗缺失值和异常值；接下来根据RFM模型构建本案例的最

近一次消费间隔、交易频率、订单总金额三个基础特征，通过描述性统计确定区间边界并计算RFM组合得分，通过随机

森林算法确定相应的因子权重并计算RFM加权得分；最后使用Excel数据透视表和Tableau进行可视化分析，重点选取累

计占比量接近97%的10组人群和占比极少但高价值的7组人群构建用户画像，从而针对性地制定运营策略。

### 2. 数据属性说明

会员ID：每个会员的ID唯一，由纯数字组成。

提交日期：订单日提交日期。

订单号：订单ID，每个订单的ID唯一，由纯数字组成。

订单金额：订单金额，浮点型数据。

会员等级：会员等级以数字区分，数字越大，级别越高。

### 3. 工具包的加载和数据读取

```
import time
import numpy as np
import pandas as pd
from sklearn.ensemble import RandomForestClassifier
```

```
sheet_names = ['2015','2016','2017','2018','会员等级']
sheet_datas = [pd.read_excel('D:/Code/User Value Analysis And Operation Strategy Based On Consumption Income/Data/sales.xlsx',sheet_name=i) for i in sheet_names]
```



# 二. 数据探索

### 1. 描述性统计

```
for each_name,each_data in zip(sheet_names,sheet_datas):    
    print('[data summary for {0:=^50}]'.format(each_name))
    # 展示数据前5条
    print('Overview:','\n',each_data.head())
    # 数据描述性信息
    print('DESC:','\n',each_data.describe())
    # 统计缺失值 
    print('NA records',each_data.isnull().any(axis=1).sum())   
    # 数据类型
    print('Dtypes',each_data.dtypes) 
```

```
[data summary for =======================2015=======================]
Overview: 
           会员ID         订单号       提交日期    订单金额
0  15278002468  3000304681 2015-01-01   499.0
1  39236378972  3000305791 2015-01-01  2588.0
2  38722039578  3000641787 2015-01-01   498.0
3  11049640063  3000798913 2015-01-01  1572.0
4  35038752292  3000821546 2015-01-01    10.1
DESC: 
                会员ID           订单号           订单金额
count  3.077400e+04  3.077400e+04   30774.000000
mean   2.918779e+10  4.020414e+09     960.991161
std    1.385333e+10  2.630510e+08    2068.107231
min    2.670000e+02  3.000305e+09       0.500000
25%    1.944122e+10  3.885510e+09      59.000000
50%    3.746545e+10  4.117491e+09     139.000000
75%    3.923593e+10  4.234882e+09     899.000000
max    3.954613e+10  4.282025e+09  111750.000000
NA records 0
Dtypes 会员ID             int64
订单号              int64
提交日期    datetime64[ns]
订单金额           float64
dtype: object
```

```
[data summary for =======================2016=======================]
Overview: 
           会员ID         订单号       提交日期    订单金额
0  39288120141  4282025766 2016-01-01    76.0
1  39293812118  4282037929 2016-01-01  7599.0
2  27596340905  4282038740 2016-01-01   802.0
3  15111475509  4282043819 2016-01-01    65.0
4  38896594001  4282051044 2016-01-01    95.0
DESC: 
                会员ID           订单号           订单金额
count  4.127800e+04  4.127800e+04   41277.000000
mean   2.908415e+10  4.313583e+09     957.106694
std    1.389468e+10  1.094572e+07    2478.560036
min    8.100000e+01  4.282026e+09       0.100000
25%    1.934990e+10  4.309457e+09      59.000000
50%    3.730339e+10  4.317545e+09     147.000000
75%    3.923182e+10  4.321132e+09     888.000000
max    3.954554e+10  4.324911e+09  174900.000000
NA records 1
Dtypes 会员ID             int64
订单号              int64
提交日期    datetime64[ns]
订单金额           float64
dtype: object
```

```
[data summary for =======================2017=======================]
Overview: 
           会员ID         订单号       提交日期    订单金额
0  38765290840  4324911135 2017-01-01  1799.0
1  39305832102  4324911213 2017-01-01   369.0
2  34190994969  4324911251 2017-01-01   189.0
3  38986333210  4324911283 2017-01-01   169.0
4      4271359  4324911355 2017-01-01    78.0
DESC: 
                会员ID           订单号           订单金额
count  5.083900e+04  5.083900e+04   50839.000000
mean   2.882368e+10  4.332466e+09     963.587872
std    1.409416e+10  4.404350e+06    2178.727261
min    2.780000e+02  4.324911e+09       0.300000
25%    1.869274e+10  4.328415e+09      59.000000
50%    3.688044e+10  4.331989e+09     149.000000
75%    3.923020e+10  4.337515e+09     898.000000
max    3.954554e+10  4.338764e+09  123609.000000
NA records 0
Dtypes 会员ID             int64
订单号              int64
提交日期    datetime64[ns]
订单金额           float64
dtype: object
```

```
[data summary for =======================2018=======================]
Overview: 
           会员ID         订单号       提交日期    订单金额
0  39229691808  4338764262 2018-01-01  3646.0
1  39293668916  4338764363 2018-01-01  3999.0
2  35059646224  4338764376 2018-01-01    10.1
3      1084397  4338770013 2018-01-01   828.0
4      3349915  4338770121 2018-01-01  3758.0
DESC: 
                会员ID           订单号           订单金额
count  8.134900e+04  8.134900e+04   81348.000000
mean   2.902317e+10  4.348372e+09     966.582792
std    1.404116e+10  4.183774e+06    2204.969534
min    2.780000e+02  4.338764e+09       0.000000
25%    1.902755e+10  4.345654e+09      60.000000
50%    3.740121e+10  4.349448e+09     149.000000
75%    3.923380e+10  4.351639e+09     899.000000
max    3.954614e+10  4.354235e+09  174900.000000
NA records 1
Dtypes 会员ID             int64
订单号              int64
提交日期    datetime64[ns]
订单金额           float64
dtype: object
```

```
[data summary for =======================会员等级=======================]
Overview: 
           会员ID  会员等级
0       100090     3
1  10012905801     1
2  10012935109     1
3  10013498043     1
4  10014087899     4
DESC: 
                会员ID           会员等级
count  1.543850e+05  154385.000000
mean   2.980055e+10       2.259701
std    1.365654e+10       1.346408
min    8.100000e+01       1.000000
25%    2.213894e+10       1.000000
50%    3.833022e+10       2.000000
75%    3.927932e+10       3.000000
max    3.954614e+10       5.000000
NA records 0
Dtypes 会员ID    int64
会员等级    int64
dtype: object
```



## 三. 数据预处理

### 1. 数据预处理

```
# 去除缺失值和异常值
for ind,each_data in enumerate(sheet_datas[:-1]):
    # 丢弃缺失值记录
    sheet_datas[ind] = each_data.dropna()
    # 丢弃订单金额<=1的记录
    sheet_datas[ind] = each_data[each_data['订单金额'] > 1]
    # 增加一列最大日期值
    sheet_datas[ind]['max_year_date'] = each_data['提交日期'].max() 
```



## 四. 特征工程

### 1. 构造RFM特征

```
# 汇总所有数据
data_merge = pd.concat(sheet_datas[:-1],axis=0)
# 获取各自年份数据
data_merge['date_interval'] = data_merge['max_year_date']-data_merge['提交日期']
data_merge['year'] = data_merge['提交日期'].dt.year
# 转换日期间隔为数字
data_merge['date_interval'] = data_merge['date_interval'].apply(lambda x: x.days)
data_merge.head()
```

|      | 会员ID      | 订单号     | 提交日期   | 订单金额 | max_year_date | date_interval | year |
| ---- | ----------- | ---------- | ---------- | -------- | ------------- | ------------- | ---- |
| 0    | 15278002468 | 3000304681 | 2015-01-01 | 499.0    | 2015-12-31    | 364           | 2015 |
| 1    | 39236378972 | 3000305791 | 2015-01-01 | 2588.0   | 2015-12-31    | 364           | 2015 |
| 2    | 38722039578 | 3000641787 | 2015-01-01 | 498.0    | 2015-12-31    | 364           | 2015 |
| 3    | 11049640063 | 3000798913 | 2015-01-01 | 1572.0   | 2015-12-31    | 364           | 2015 |
| 4    | 35038752292 | 3000821546 | 2015-01-01 | 10.1     | 2015-12-31    | 364           | 2015 |

```
# 按会员ID做汇总
# 计算最近一次订单时间
rfm_gb = data_merge.groupby(['year','会员ID'],as_index=False).agg({'date_interval': 'min',  
                                                   '提交日期': 'count', # 计算订单频率
                                                   '订单金额': 'sum'})  # 计算订单总金额
# 重命名列名
rfm_gb.columns =  ['year','会员ID','r','f','m']
rfm_gb.head()
```

|      | year | 会员ID | r    | f    | m      |
| ---- | ---- | ------ | ---- | ---- | ------ |
| 0    | 2015 | 267    | 197  | 2    | 105.0  |
| 1    | 2015 | 282    | 251  | 1    | 29.7   |
| 2    | 2015 | 283    | 340  | 1    | 5398.0 |
| 3    | 2015 | 343    | 300  | 1    | 118.0  |
| 4    | 2015 | 525    | 37   | 3    | 213.0  |

### 2. 计算组合得分

#### （1）定义区间边界

```
# 查看数据分布
desc_pd = rfm_gb.iloc[:,2:].describe().T
print(desc_pd)
# 定义区间边界
r_bins = [-1,79,255,365] # 注意起始边界小于最小值
f_bins = [0,2,5,130] 
m_bins = [0,69,1199,206252]
```

|      | count    | mean        | std         | min  | 25%  | 50%   | 75%    | max      |
| ---- | -------- | ----------- | ----------- | ---- | ---- | ----- | ------ | -------- |
| r    | 148591.0 | 165.524043  | 101.988472  | 0.0  | 79.0 | 156.0 | 255.0  | 365.0    |
| f    | 148591.0 | 1.365002    | 2.626953    | 1.0  | 1.0  | 1.0   | 1.0    | 130.0    |
| m    | 148591.0 | 1323.741329 | 3753.906883 | 1.5  | 69.0 | 189.0 | 1199.0 | 206251.8 |

#### （2）计算分箱得分

```
# RFM分箱得分
# 计算R得分
rfm_gb['r_score'] = pd.cut(rfm_gb['r'], r_bins, labels=[i for i in range(len(r_bins)-1,0,-1)])
# 计算F得分
rfm_gb['f_score'] = pd.cut(rfm_gb['f'], f_bins, labels=[i+1 for i in range(len(f_bins)-1)])
# 计算M得分
rfm_gb['m_score'] = pd.cut(rfm_gb['m'], m_bins, labels=[i+1 for i in range(len(m_bins)-1)]) 
```

```
print(rfm_gb.head())
```

|      | year | 会员ID | r    | f    | m      | r_score | f_score | m_score |
| ---- | ---- | ------ | ---- | ---- | ------ | ------- | ------- | ------- |
| 0    | 2015 | 267    | 197  | 2    | 105.0  | 2       | 1       | 2       |
| 1    | 2015 | 282    | 251  | 1    | 29.7   | 2       | 1       | 1       |
| 2    | 2015 | 283    | 340  | 1    | 5398.0 | 1       | 1       | 3       |
| 3    | 2015 | 343    | 300  | 1    | 118.0  | 1       | 1       | 2       |
| 4    | 2015 | 525    | 37   | 3    | 213.0  | 3       | 2       | 2       |

### 3. 计算加权得分

#### （1）随机森林

```
# 匹配会员等级和rfm得分
rfm_merge = pd.merge(rfm_gb,sheet_datas[-1],on='会员ID',how='inner')
```

```
# 随机森林获得rfm因子得分
clf = RandomForestClassifier()
clf = clf.fit(rfm_merge[['r','f','m']],rfm_merge['会员等级'])
weights = clf.feature_importances_
print('feature importance:',weights)
```

```
feature importance: [0.4129498  0.00636692 0.58068329]
```

#### （2）加权得分

```
# 方法二：加权得分
rfm_gb = rfm_gb.apply(np.int32) # cate转数值
rfm_gb['rfm_score'] = rfm_gb['r_score'] * weights[0] + rfm_gb['f_score'] * weights[1] + rfm_gb['m_score']
```

```
print(rfm_gb.head())
```

|      | year | 会员ID | r    | f    | m    | r_score | f_score | m_score | rfm_group | rfm_score |
| ---- | ---- | ------ | ---- | ---- | ---- | ------- | ------- | ------- | --------- | --------- |
| 0    | 2015 | 267    | 197  | 2    | 105  | 2       | 1       | 2       | 212       | 1.994159  |
| 1    | 2015 | 282    | 251  | 1    | 29   | 2       | 1       | 1       | 211       | 1.406509  |
| 2    | 2015 | 283    | 340  | 1    | 5398 | 1       | 1       | 3       | 113       | 2.175301  |
| 3    | 2015 | 343    | 300  | 1    | 118  | 1       | 1       | 2       | 112       | 1.587650  |
| 4    | 2015 | 525    | 37   | 3    | 213  | 3       | 2       | 2       | 322       | 2.406509  |

#### （3）输出数据

```
rfm_gb.to_excel('D:/Code/User Value Analysis And Operation Strategy Based On Consumption Income/Result/sales_rfm_score.xlsx')
```

## 

## 五. 运营策略

### 1. 基于Tableau的趋势分析



### 2. 基于Excel数据透视表的用户画像及运营策略

#### （1）数据透视表结果



| **RFM分组** | **用户量占比** | **用户累计量占比** |
| ----------- | -------------- | ------------------ |
| 212         | 24.79%         | 24.79%             |
| 211         | 12.80%         | 37.59%             |
| 312         | 12.55%         | 50.15%             |
| 112         | 11.34%         | 61.49%             |
| 213         | 11.02%         | 72.50%             |
| 311         | 6.24%          | 78.74%             |
| 111         | 6.14%          | 84.88%             |
| 313         | 5.61%          | 90.49%             |
| 113         | 5.07%          | 95.57%             |
| 123         | 1.30%          | 96.87%             |
| 233         | 0.70%          | 97.57%             |
| 122         | 0.68%          | 98.25%             |
| 333         | 0.33%          | 98.58%             |
| 133         | 0.32%          | 98.90%             |
| 322         | 0.28%          | 99.17%             |
| 222         | 0.25%          | 99.42%             |
| 223         | 0.25%          | 99.67%             |
| 323         | 0.25%          | 99.92%             |
| 332         | 0.02%          | 99.94%             |
| 321         | 0.02%          | 99.97%             |
| 221         | 0.02%          | 99.98%             |
| 232         | 0.01%          | 99.99%             |
| 121         | 0.01%          | 100.00%            |
| 132         | 0.00%          | 100.00%            |
| 331         | 0.00%          | 100.00%            |
| **总计**    | **100.00%**    | **100.00%**        |

#### （2）运营策略

##### A. 第1类人群

特征：占比超过10%的群体。由于这类人群基数大,必须采取批量操作和运营的方式落地运营策略,一般需要通过系统或产品实现,而不能主要依赖于人工

 212:可发展的一般性群体。这类群体购买新近度和订单金额一般,且购买频率低。考虑到其最大的群体基础,以及在新近度和订单金额上都可以,因此可采取常规性的礼品兑换和赠送、购物社区活动、签到、免运费等手段维持并提升其消费状态。

 211:可发展的低价值群体。这类群体相对于212群体在订单金额上表现略差,因此在21l群体策略的基础上,可以增加与订单相关的刺激措施,例如组合商品优惠券发送积分购买商品等。

312:有潜力的一般性群体。这类群体购买新近度高,说明最近一次购买发生在很短时间之前,群体对于公司尚有比较熟悉的接触渠道和认知状态;购物频率低,说明对网站的忠诚度一般;订单金额处于中等层级,说明其还具有可提升的空间。因此,可以借助其最近购买的商品,为其定制一些与上次购买相关的商品,通过向上销售等策略提升购买频次和订单金额。

112:可挽回的一般性群体。这类群体购买新近度较低,说明距离上次购买时间较长,很可能用户已经处于沉默或预流失、流失阶段;购物频率低,说明对网站的忠诚度一般;订单金额处于中等层级,说明其还可能具有可提升的空间。因此,对这部分群体的策略首先是通过多种方式(例如邮件、短信等)触达客户并挽回,然后通过针对流失客户的专享优惠(例如流失用户专享优惠券)措施促进其消费。在此过程中,可通过增加接触频次和刺激力度的方式,增加用户的回访、复购以及订单价值回报。

213:可发展的高价值群体。这类人群发展的重点是提升购物频率,因此可指定不同的活动或事件来触达用户,促进其回访和购买,例如不同的节日活动、每周新品推送、高价值客户专享商品等。

##### B. 第2类人群

特征：占比为1%-10%的群体。这部分人群数量适中,在落地时无论是产品还是人工都可接入

311:有潜力的低价值群体。这部分用户与211群体类似,但在购物新近度上更好,因此对其可采取相同的策略。除此以外,在这类群体的最近接触渠道上可以增加营销或广告资源投入,通过这些渠道再次将客户引入网站完成消费。

111:这是一类在各个维度上都比较差的客户群体。一般情况下,会在其他各个群体策略和管理都落地后才考虑他们。主要策略是先通过多种策略挽回客户,然后为客户推送与其类似的其他群体,或者当前热销的商品或折扣非常大的商品。在刺激消费时,可根据其消费水平、品类等情况,有针对性地设置商品暴露条件,先在优惠券及优惠商品的综合刺激下使其实现消费,再考虑消费频率以及订单金额的提升。

313:有潜力的高价值群体。这类群体的消费新近度高且订单金额高,但购买频率低,因此只要提升其购买频次,

用户群体的贡献价值就会倍增。提升购买频率上,除了在其最近一次的接触渠道上增加曝光外,与最近一次渠道相关的其他关联访问渠道也要考虑增加营销资源。另外,213中的策略也要组合应用其中。 

113:可挽回的高价值群体。这类群体与112群体类似,但订单金额贡献更高,因此除了应用112中的策略外,可增加部分人工的参与来挽回这些高价值客户,例如线下访谈客户电话沟通等.

##### C. 第3类群体

特征：占比非常少,但却是非常重要的群体

333:绝对忠诚的高价值群体。虽然用户绝对数量只有355,但由于其各方面表现非常突出,因此可以倾斜更多的资源,例如设计VIP服务、专享服务、绿色通道等。另外,针对这部分人群的高价值附加服务的推荐也是提升其价值的重点策略。

233、223和133:一般性的高价值群体。这类群体的主要着手点是提升新近购买度,即促进其实现最近一次的购买,可通过DM、电话、客户拜访、线下访谈、微信、电子邮件等方式直接建立用户挽回通道,以挽回这部分高价值用户。

322、323和332:有潜力的普通群体。这类群体最近刚完成购买,需要提升的是购买频次及购买金额。因此可通过交叉销售、个性化推荐、向上销售、组合优惠券、打包商品销售等策略,提升其单次购买的订单金额及促进其重复购买。